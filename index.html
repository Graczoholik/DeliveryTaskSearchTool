<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Wyszukiwarka by Graczu ‚Äì Tibia</title>
  <style>
    body {
      font-family: 'Trebuchet MS', Arial, sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      color: #3b2f1c;
      background:
        linear-gradient(rgba(255,255,240,0.92), rgba(255,255,240,0.92)),
        repeating-linear-gradient(
          45deg,
          #e6d8b5,
          #e6d8b5 10px,
          #eadfc2 10px,
          #eadfc2 20px
        );
    }

    h1 { margin-bottom: 20px; }

    .search-bar {
      max-width: 600px;
      margin-bottom: 20px;
      display: flex;
      gap: 8px;
    }

    input {
      flex: 1;
      padding: 14px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #b89b5e;
      background: #fffaf0;
    }

    button {
      padding: 14px 18px;
      border-radius: 6px;
      border: 1px solid #b89b5e;
      background: #e6d8b5;
      cursor: pointer;
    }

    h2 { margin-top: 30px; }

    .item {
      background: #fffaf0;
      border: 1px solid #c9b27c;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    .icon {
      width: 32px;
      height: 32px;
      image-rendering: pixelated;
      flex-shrink: 0;
    }

    .name {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 6px;
    }

    .meta {
      font-size: 14px;
      color: #555;
    }

    footer {
      margin-top: 40px;
      text-align: center;
      color: #777;
      font-size: 13px;
    }
  </style>
</head>
<body>

<h1>üó°Ô∏è Wyszukiwarka by Graczu üõ°Ô∏è</h1>

<div class="search-bar">
  <input type="text" id="search" placeholder="Wpisz nazwƒô przedmiotu..." />
  <button id="btnSearch">Search</button>
</div>

<div id="status" style="max-width:600px; margin-bottom:10px; color:#6b5b3d;"></div>
<div id="results"></div>

<footer>
  ‚öîÔ∏è Powered by <strong>El Quattro</strong> ‚Ä¢ Tibia RPG Vibes ‚öîÔ∏è
</footer>

<script>
  const searchInput = document.getElementById('search');
  const resultsDiv = document.getElementById('results');
  const btnSearch = document.getElementById('btnSearch');

  let items = [];

  function normalizeIconPath(p) {
    if (!p) return 'icons/unknown.gif';
    return String(p).trim().replace(/\\/g, '/'); // Windows -> web
  }

  fetch('items.json')
    .then(res => res.json())
    .then(data => {
      const raw = Array.isArray(data) ? data : (data.items || []);
      items = raw
        .map(i => ({
          name: String(i.name || i.Name || '').trim(),
          category: (i.category || i.Category || 'Inne'),
          weight: String(i.weight || i.Weight || i.waga || i.Waga || '-').trim(),
          dropsFrom: Array.isArray(i.dropsFrom || i.drops_from)
            ? (i.dropsFrom || i.drops_from).join(', ')
            : String(i.dropsFrom || i.drops_from || i.Drop || i.drop || '-'),
          icon: normalizeIconPath(i.icon || i.Icon || i.image || i.img)
        }))
        .filter(i => i.name.length > 0);

      // status + pierwsza pr√≥bka do debugowania
      const missingIcon = items.filter(x => !x.icon || x.icon === 'icons/unknown.gif').length;
      document.getElementById('status').textContent = `Za≈Çadowano: ${items.length} ‚Ä¢ Brak ikony w danych: ${missingIcon}`;
      console.log('Sample item:', items[0]);
      renderResults(items);
    })
    .catch(err => {
      resultsDiv.innerHTML = '<p>B≈ÇƒÖd ≈Çadowania items.json</p>';
      console.error(err);
    });

  function renderResults(list) {
    resultsDiv.innerHTML = '';

    if (!list || list.length === 0) {
      resultsDiv.innerHTML = '<p>Brak wynik√≥w</p>';
      return;
    }

    const grouped = {};
    list.forEach(item => {
      if (!grouped[item.category]) grouped[item.category] = [];
      grouped[item.category].push(item);
    });

    Object.keys(grouped).sort().forEach(category => {
      const h = document.createElement('h2');
      h.textContent = category;
      resultsDiv.appendChild(h);

      grouped[category]
        .sort((a, b) => a.name.localeCompare(b.name))
        .forEach(item => {
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `
            <img src="${item.icon || 'icons/unknown.gif'}" class="icon" alt="${item.name}" onerror="this.onerror=null; this.src='icons/unknown.gif';">
            <div>
              <div class="name">${item.name}</div>
              <div class="meta"><strong>Waga:</strong> ${item.weight} oz</div>
              <div class="meta"><strong>Wypada z:</strong> ${item.dropsFrom}</div>
            </div>
          `;
          resultsDiv.appendChild(div);
        });
    });
  }

  function runSearch() {
    const q = searchInput.value.toLowerCase().trim();
    if (!q) {
      renderResults(items);
      return;
    }
    const filtered = items.filter(i => i.name.toLowerCase().includes(q));
    renderResults(filtered);
  }

  btnSearch.addEventListener('click', runSearch);
  searchInput.addEventListener('input', runSearch);
  searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') runSearch();
  });
</script>

</body>
</html>
